# 飞机票对比小程序部署指南 🚀

## 快速部署步骤

### 1. 环境准备
- ✅ 微信开发者工具 (最新版本)
- ✅ 腾讯云开发账号
- ✅ 微信小程序开发账号

### 2. 项目导入
1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择项目目录：`miniprogram-cloudbase-miniprogram-template`
4. 填写项目名称和AppID

### 3. 云开发环境配置

#### 3.1 获取环境ID
```bash
# 使用MCP工具查询环境信息
mcp_cloudbase_getEnvInfo
```

#### 3.2 更新环境配置
在 `miniprogram/app.js` 中更新环境ID：
```javascript
wx.cloud.init({
  env: 'your-actual-env-id', // 替换为你的环境ID
  traceUser: true,
});
```

### 4. 云函数部署

#### 4.1 自动部署（推荐）
项目已配置好云函数，直接在开发者工具中：
1. 右键点击 `cloudfunctions` 文件夹
2. 选择"同步云函数列表"
3. 分别右键每个云函数文件夹，选择"上传并部署"

#### 4.2 手动部署
使用CloudBase CLI：
```bash
# 安装CLI
npm install -g @cloudbase/cli

# 登录
tcb login

# 部署函数
tcb functions:deploy getFlights
tcb functions:deploy getBookings  
tcb functions:deploy saveUserInfo
```

### 5. 数据库初始化

#### 5.1 创建集合
数据库集合已自动创建：
- ✅ `flights` - 航班信息
- ✅ `bookings` - 预订记录
- ✅ `users` - 用户信息

#### 5.2 权限设置
建议权限配置：
```json
{
  "flights": "所有人可读，仅管理端可写",
  "bookings": "仅创建者可读写", 
  "users": "仅创建者可读写"
}
```

### 6. 功能测试

#### 6.1 基础功能测试
- [ ] 页面导航正常
- [ ] 搜索功能工作
- [ ] 航班筛选功能
- [ ] 航班选择和对比
- [ ] 用户信息授权

#### 6.2 云函数测试
在开发者工具控制台测试：
```javascript
// 测试获取航班
wx.cloud.callFunction({
  name: 'getFlights',
  data: {
    departure: '北京',
    arrival: '上海',
    includeBasicFares: true,
    nonstopFlights: false
  }
}).then(res => {
  console.log('航班数据:', res.result);
});

// 测试用户信息保存
wx.cloud.callFunction({
  name: 'saveUserInfo',
  data: {
    userInfo: {
      nickName: '测试用户',
      avatarUrl: 'test-avatar-url'
    }
  }
}).then(res => {
  console.log('保存结果:', res.result);
});
```

### 7. 图标资源处理

#### 7.1 当前状态
项目使用占位图标文件，需要替换为真实图标。

#### 7.2 替换图标
将以下文件替换为真实图标：
```
miniprogram/images/
├── home.png & home-active.png
├── search.png & search-active.png  
├── bookings.png & bookings-active.png
├── profile.png & profile-active.png
├── departure.png
├── arrival.png
├── calendar.png
├── person.png
├── swap.png
├── mic.png
└── default-avatar.png
```

#### 7.3 图标规格建议
- TabBar图标：64px × 64px
- 功能图标：48px × 48px
- 格式：PNG（支持透明）

### 8. 预览和调试

#### 8.1 本地预览
1. 在开发者工具中点击"预览"
2. 扫码在手机上测试
3. 检查各项功能是否正常

#### 8.2 真机调试
1. 点击"真机调试"
2. 扫码连接手机
3. 在真机上测试完整功能

### 9. 发布上线

#### 9.1 体验版发布
1. 点击"上传"按钮
2. 填写版本号和项目备注
3. 在微信公众平台设为体验版

#### 9.2 正式发布
1. 在微信公众平台提交审核
2. 等待审核通过
3. 发布上线

## 常见问题解决 🔧

### Q1: 云函数调用失败
**解决方案：**
1. 检查环境ID是否正确
2. 确认云函数已正确部署
3. 检查网络连接

### Q2: 图标显示异常
**解决方案：**
1. 替换占位图标为真实图标
2. 检查图标路径是否正确
3. 确认图标格式和尺寸

### Q3: 数据库权限错误
**解决方案：**
1. 在云开发控制台检查集合权限
2. 确认用户身份验证状态
3. 检查云函数中的数据库操作

### Q4: 页面样式异常
**解决方案：**
1. 检查CSS样式文件
2. 确认rpx单位使用正确
3. 测试不同设备尺寸适配

## 性能优化建议 ⚡

### 1. 图片优化
- 使用WebP格式图片
- 压缩图片文件大小
- 使用CDN加速图片加载

### 2. 代码优化
- 启用代码压缩
- 使用懒加载技术
- 优化云函数响应时间

### 3. 缓存策略
- 实现本地数据缓存
- 使用小程序存储API
- 合理设置缓存过期时间

## 技术支持 📞

如遇到部署问题，可以：
1. 查看微信开发者工具控制台错误信息
2. 检查云开发控制台日志
3. 参考官方文档和社区解答

---

**祝您部署顺利！** 🎉 